# ğŸ—ƒï¸çŠ¶æ…‹ç®¡ç†
* useState
* jotai

ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

åŸºæœ¬çš„ã«ã¯useStateã‚’åˆ©ç”¨ã—propsã§å­ã«å—ã‘æ¸¡ã—ã¾ã—ã‚‡ã†ã€‚

![localstate](./images/localstate.png)

ã—ã‹ã—ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ‡ã‚Šåˆ†ã‘ã‚„å‘¼ã³å‡ºã—ãŒã‚ã‚‹ã¨**propsãƒªãƒ¬ãƒ¼(props drilling)** ãŒç™ºç”Ÿã—ã¾ã™ã€‚

![propsdrilling](./images/propsdrilling.png)

ã“ã‚Œã¯ãã®çŠ¶æ…‹ã«é–¢å¿ƒãŒãªã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚‚çŠ¶æ…‹ãŒã‚ãŸã‚‹ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¯†çµåˆã«ãªã‚‹ãªã©ã„ãã¤ã‹èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚  
ãã†ã„ã£ãŸå ´åˆã«ã¯jotaiã‚’ç”¨ã„ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªStateã‚’ç”¨ã„ã¦ãã ã•ã„ã€‚

![globalstate](./images/globalstate.png)

ã“ã‚Œã«ã‚ˆã‚Šç°è‰²ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¯çŠ¶æ…‹ãŒã‚ãŸã‚‰ãš `view-component` ã¨ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å°‚å¿µã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€æœ«ç«¯ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚ `model-component` ã¨ã—ã¦çŠ¶æ…‹ã¨ãã®è¡¨ç¤ºã«å°‚å¿µã§ãã‚‹ã§ã—ã‚‡ã†ã€‚

jotaiã¯ã“ã®ã‚ˆã†ãªåŠã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹å…±æœ‰ã‚„Hooksã¨ç›¸æ€§ã®è‰¯ã„çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
é¡ä¼¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«RecoilãŒã‚ã‚Šã¾ã™ãŒã€æœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ãªã“ã¡ã‚‰ã‚’é¸å®šã—ã¾ã—ãŸã€‚  
https://jotai.org/  
ã‚­ãƒ£ãƒ©ã«ç‹¬ç‰¹ã®å¯æ„›ã•ãŒã‚ã‚Šã¾ã™ã­ã€‚

éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§useStateã¨ä¼¼ãŸä½¿ç”¨æ„ŸãŒã‚ã‚Šã¾ã™ã€‚
```tsx
//store.ts
import { atom } from 'jotai'

const countAtom = atom(0)

//Counter.tsx
import { useAtom } from 'jotai'

const Counter = () => {
   const [count, setCount] = useAtom(countAtom);
  return (
    <div>
      {count} <button onClick={() => setCount((c) => c + 1)}>+1</button>
    </div>
  );
}
```

ã‚°ãƒ­ãƒ¼ãƒãƒ«Stateã¯ã‚ˆãç©ºé–“ã®æ±šæŸ“ãŒæ‡¸å¿µã•ã‚Œã¾ã™ã€‚
ãã®éš›ã«ã¯çŠ¶æ…‹ã‚’å…±æœ‰ã—ãŸã„ä¸€ã¤ä¸Šã‚’Providerã§å›²ã£ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚
```tsx
import { Provider } from "jotai";

const SomeComponent = () => (
  <Provider>
    <SomeComponent />
  </Provider>
)
```
Providerã¯[ã“ã¡ã‚‰ã®å‹•ç”»](https://egghead.io/lessons/react-isolate-state-in-an-application-with-jotai-provider)ã§è©³ç´°ãªä½¿ã„æ–¹ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã§ã€ã“ã‚Œã¯æ³¨æ„ã—ãªãã¦ã¯ãªã‚‰ãªã„å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚ã›ã£ã‹ãglobalã«ä½¿ç”¨ã—ãŸã„çŠ¶æ…‹ãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ã€ProviderãŒå­˜åœ¨ã™ã‚‹ã¨ãã®ä¸‹ã§ã¯åˆ¥ã®çŠ¶æ…‹ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚  
ä¾‹ã‚’æŒ™ã’ã‚‹ã¨ã€ã€Œã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã®çŠ¶æ…‹ãŒåˆ¥ã‚‚ã®ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã†ã€ã‚±ãƒ¼ã‚¹ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

**åŸºæœ¬ã¯ `Provider-less mode` ã§åˆ©ç”¨ã—ã€`feature/Componentå`ãƒ»`pages/Componentå` ç›´ä¸‹ã§å®šç¾©ã—æ“¬ä¼¼çš„ãªã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç²å¾—ã™ã‚‹ã€‚** ç‰¹æ®Šãªã‚±ãƒ¼ã‚¹ã§ `Provider` ã‚’åˆ©ç”¨ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚



## APIé€šä¿¡ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ã¨APIé€šä¿¡ã¯å¯†æ¥ãªé–¢ä¿‚ã«ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ãã®çŠ¶æ…‹ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ä½¿ã„å›ã™ã€ãªã©ã§ã™ã€‚  
Reactã«ã¯ã‚µãƒ¼ãƒãƒ¼é€šä¿¡ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã«ä»–ã«ã‚‚ãƒ¡ã‚¸ãƒ£ãƒ¼ãªæ‰‹æ®µãŒã‚Šã¾ã™ã€‚

ãã‚ŒãŒ
* [react-query](https://react-query.tanstack.com/)
* [swr](https://swr.vercel.app/ja)
* [apollo client](https://www.apollographql.com/)
* [urql](https://formidable.com/open-source/urql/)

ãªã©ã§ã™ã€‚[bulletproof-react](https://github.com/alan2207/bulletproof-react/blob/master/docs/state-management.md#server-cache-state)ã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã®ã§ãã¡ã‚‰ã‚‚ã”è¦§ãã ã•ã„ã€‚

ä¸Šè¨˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç«¯çš„ã«ã¾ã¨ã‚ã‚‹ã¨
1. æƒ…å ±ã‚’ãƒ•ã‚§ãƒƒãƒã™ã‚‹
2. æƒ…å ±ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã«ã¨ã£ã¦ãŠã(ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–ã™ã‚‹)
3. æ¬¡å›ãƒ•ã‚§ãƒƒãƒæ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰æƒ…å ±ã‚’è¿”ã™(ç„¡ç”¨ãªAPIé€šä¿¡ã‚’é¿ã‘é«˜é€ŸåŒ–ã‚’å›³ã‚‹)

ã¨ã„ã†å½¹å‰²ã‚’æŒã¤ã‚‚ã®ã¨ãªã‚Šã€çŠ¶æ…‹ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«stateã«setã™ã‚‹æ‰‹é–“ãŒæ¸›ã‚Šä¾¿åˆ©ã§ã™ã€‚  
ä¸€æ–¹ã§ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã®ã§é©åˆ‡ã«æ‰±ã‚ãªã‘ã‚Œã°å¤ã„æƒ…å ±ãŒè¿”ã£ã¦ãã‚‹ãªã©ã®å•é¡ŒãŒç”Ÿã˜ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ ¹åº•ã«ã¯ `stale-while-revalidate` ã¨ã„ã†è€ƒãˆæ–¹ãŒã‚ã‚Šã¾ã™ã€‚æ­£ã—ãé‹ç”¨ã™ã‚‹ãŸã‚ã«ã‚‚ã€å°å…¥å‰ã«ä¸€åº¦è§¦ã‚Œã¦ãŠãã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚[å‚è€ƒ](https://zenn.dev/uttk/articles/b3bcbedbc1fd00#swr-%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B%EF%BC%9F)

ä¸Šè¨˜ã®ä¸­ã‹ã‚‰ã€æœ¬ãƒªãƒã‚¸ãƒˆãƒªã§ã¯`Tanstack Query(React Query)`ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ 
æœ€ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ã“ã¨ã‚„ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®keyã¨ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã®é–¢æ•°ãŒç‹¬ç«‹ã—ã¦ãŠã‚Šç´°ã‹ã„èª¿æ•´ãŒã—ã‚„ã™ã„ã“ã¨ã‹ã‚‰é¸å®šã—ã¾ã—ãŸã€‚

ä½¿ç”¨æ–¹æ³•ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://swr.vercel.app/ja/docs/getting-started)ã‚„ä»¥ä¸‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚
- [éåŒæœŸå‡¦ç†ã«ç–²ã‚ŒãŸæ–¹ã«ã€ReactQueryã®å‡¦æ–¹ç®‹](https://zenn.dev/t_keshi/articles/react-query-prescription)
- [React Queryã‚’ä½¿ã„ã“ãªã™ãŸã‚ã«è©¦ã—ãŸã“ã¨](https://zenn.dev/himorishige/articles/76e903bc5a1aa2)
- [Filtering a fetched list from an API using React Query](https://stackoverflow.com/questions/66797655/filtering-a-fetched-list-from-an-api-using-react-query)


## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‡ºã—åˆ†ã‘ã¨Suspense
ä¸Šè¨˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™éš›ã«
* data
* error
* isLoading(fetching)

ãªã©ã®çŠ¶æ…‹ã‚’è¿”å´ã—ã¦ãã‚Œã¾ã™ã€‚ã¾ãŸã€Reactã¯ã‚ãã¾ã§é–¢æ•°ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚

ã—ãŸãŒã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‡ºã—ã‚ã‘ã€è¿”å´å€¤ã‚’åˆ†å²ã•ã›ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä½¿ãˆã¾ã™ã€‚
```jsx
function Example() {
  const { isLoading, error, data } = useQuery(['repoData'], () =>
    fetch('https://api.github.com/repos/tannerlinsley/react-query').then(res =>
      res.json()
    )
  )

  if (isLoading) return 'Loading...'

  if (error) return 'An error has occurred: ' + error.message

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>{' '}
      <strong>âœ¨ {data.stargazers_count}</strong>{' '}
      <strong>ğŸ´ {data.forks_count}</strong>
    </div>
  )
}
```
[Tanstack Queryã‚ˆã‚Šå¼•ç”¨](https://tanstack.com/query/v4/docs/overview)

ã‚¨ãƒ©ãƒ¼ãŒç”Ÿã˜ãŸã‚‰å¤±æ•—ã®è¡¨ç¤ºã‚’ã€ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿”ã™ã¨ã„ã†å½¢ã§ã™ã­ã€‚

åŸºæœ¬ã¯ã“ã¡ã‚‰ã®å®Ÿè£…ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€React 18ã‹ã‚‰ä¼¼ãŸæ©Ÿèƒ½ã¨ã—ã¦ `Suspense` ãŒå°å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸ `Suspense` ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã«ã‚‚å¯„ä¸ã—ã¾ã™ã€‚[å‚è€ƒ](https://qiita.com/uhyo/items/bbc22022fe846fd2b763)

å®Ÿè£…æ–¹æ³•ã¨ã—ã¦ã¯
* å¯¾å¿œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹
* Suspenseã§å›²ã‚€
* fallbackç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹

ã¨ã„ã†ç¨‹åº¦ã§ã™ã®ã§è² æ‹…ã¯å¤§ããã‚ã‚Šã¾ã›ã‚“ã€‚  

```jsx
<Suspense fallback={<div>ã‚µã‚¹ãƒšãƒ³ãƒ‰ã—ãŸã‚‰ã“ã‚ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹</div>}>
  {/* â†“ã‚µã‚¹ãƒšãƒ³ãƒ‰ã—ãªã‹ã£ãŸã‚‰ã“ã‚ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹ */}
  <MyComponent />
</Suspense>
```
[Reactã®Suspenseå¯¾å¿œéåŒæœŸå‡¦ç†ã‚’æ‰‹æ›¸ãã™ã‚‹ãƒãƒ³ã‚ºã‚ªãƒ³ ã‚ˆã‚Šå¼•ç”¨](https://zenn.dev/uhyo/books/react-concurrent-handson/viewer/what-is-suspense)

ã—ã‹ã—ç™»å ´ã—ã¦é–“ã‚‚ãªã„æŠ€è¡“ã§ã‚ã‚‹ã“ã¨ã€å†…éƒ¨å®Ÿè£…ãŒå°‘ã€…ç‰¹ç•°ã§ã‚ã‚‹ãŸã‚å°å…¥ã¯ãƒãƒ¼ãƒ ã§è©±ã—åˆã£ã¦æ±ºå®šã—ã¾ã—ã‚‡ã†ã€‚

<br>
<br>
<br>

[>>ã€ŒğŸ§ªãƒ†ã‚¹ãƒˆã€ã¸é€²ã‚€](./test.md)